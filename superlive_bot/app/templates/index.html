<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superlive Gift Bot - Commander</title>
    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Google Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Roboto', sans-serif; }
        .card { background-color: #1e1e1e; border-radius: 12px; }
        .card-title { color: #bb86fc !important; font-weight: bold; }
        .input-field input, .input-field label { color: #e0e0e0 !important; }
        .input-field input:focus { border-bottom: 1px solid #bb86fc !important; box-shadow: 0 1px 0 0 #bb86fc !important; }
        .btn-large { border-radius: 8px; font-weight: bold; }
        .status-badge { padding: 5px 10px; border-radius: 4px; font-weight: bold; background: #333; color: #fff; }
        .status-running { background: #00c853; color: white; }
        .status-stopped { background: #d50000; color: white; }
        .status-paused { background: #ffab00; color: black; }
        #console-log { height: 200px; overflow-y: auto; background: #000; padding: 10px; font-family: monospace; font-size: 12px; border-radius: 4px; color: #00e676; border: 1px solid #333; }
    </style>
</head>
<body>
    <nav class="black z-depth-2">
        <div class="nav-wrapper container">
            <a href="#" class="brand-logo"><i class="material-icons left">card_giftcard</i>Superlive Bot</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="#" class="tooltipped" data-position="bottom" data-tooltip="v2.0 Pro"><i class="material-icons">info_outline</i></a></li>
            </ul>
        </div>
    </nav>

    <div class="container" style="margin-top: 40px;">
        <div class="row">
            <!-- Control Panel -->
            <div class="col s12 m6">
                <div class="card z-depth-4">
                    <div class="card-content">
                        <span class="card-title">Mission Control</span>
                        <div class="row">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">live_tv</i>
                                <input id="livestream_id" type="text" class="validate">
                                <label for="livestream_id">Target Livestream ID</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">group</i>
                                <input id="worker_count" type="number" value="1" min="1">
                                <label for="worker_count">Workers</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">vpn_lock</i>
                                <input id="proxy_count" type="number" value="0" min="0">
                                <label for="proxy_count">Proxies (0=Direct)</label>
                            </div>
                        </div>
                        <div class="row center-align">
                            <button class="btn-large waves-effect waves-light purple accent-3" onclick="sendCommand(10)">
                                <i class="material-icons left">play_arrow</i>Start
                            </button>
                            <button class="btn-large waves-effect waves-light orange darken-3" onclick="sendCommand(11)">
                                <i class="material-icons left">pause</i>Pause
                            </button>
                            <button class="btn-large waves-effect waves-light red accent-4" onclick="sendCommand(12)">
                                <i class="material-icons left">stop</i>Stop
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Panel -->
            <div class="col s12 m6">
                <div class="card z-depth-4">
                    <div class="card-content">
                        <span class="card-title">System Status <small class="right status-badge" id="status-badge">READY</small></span>
                        <p style="margin-bottom: 10px;">Monitor real-time operations.</p>
                        <div id="console-log">
                            <div>> System Initialized...</div>
                        </div>
                    </div>
                    <div class="card-action right-align">
                         <a href="#" class="grey-text" onclick="clearLog()">Clear Log</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        // Init Tooltips
        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.tooltipped');
            M.Tooltip.init(elems);
        });

        function log(msg, type='info') {
            const consoleBox = document.getElementById('console-log');
            const time = new Date().toLocaleTimeString();
            let color = '#00e676'; // green
            if (type === 'error') color = '#ff1744';
            if (type === 'warn') color = '#ffea00';
            
            const div = document.createElement('div');
            div.style.color = color;
            div.innerHTML = `[${time}] ${msg}`;
            consoleBox.appendChild(div);
            consoleBox.scrollTop = consoleBox.scrollHeight;
        }

        function clearLog() {
            document.getElementById('console-log').innerHTML = '<div>> Log Cleared.</div>';
        }

        function updateStatus(status) {
            const badge = document.getElementById('status-badge');
            badge.className = 'status-badge';
            if (status === 'started') { badge.classList.add('status-running'); badge.innerText = "RUNNING"; }
            if (status === 'paused') { badge.classList.add('status-paused'); badge.innerText = "PAUSED"; }
            if (status === 'stopped') { badge.classList.add('status-stopped'); badge.innerText = "STOPPED"; }
        }

        async function sendCommand(code) {
            const livestreamId = document.getElementById('livestream_id').value;
            const worker = document.getElementById('worker_count').value;
            const useProxy = document.getElementById('proxy_count').value;

            // Validation for Start
            if (code === 10 && !livestreamId) {
                M.toast({html: '⚠️ Target ID Required!', classes: 'red'});
                log('Error: Target ID missing', 'error');
                return;
            }

            const payload = {
                code: code,
                livestream_id: livestreamId,
                worker: parseInt(worker),
                use_proxy: parseInt(useProxy)
            };

            log(`Sending Command: ${code} (Workers: ${worker}, Proxy: ${useProxy})...`);

            try {
                const response = await fetch('/auto/gift', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    M.toast({html: `✅ Success: ${data.status}`, classes: 'green'});
                    log(`Server: ${JSON.stringify(data)}`);
                    updateStatus(data.status);
                } else {
                    M.toast({html: `❌ Error: ${data.message}`, classes: 'red'});
                    log(`Error: ${data.message}`, 'error');
                }
            } catch (error) {
                M.toast({html: '❌ Network Error', classes: 'red'});
                log(`Network Error: ${error}`, 'error');
            }
        }
    </script>
</body>
</html>
